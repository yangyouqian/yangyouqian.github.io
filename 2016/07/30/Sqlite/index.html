<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="1.MyOpenHelper帮助类Create a helper object to create, open, and/or manage a database.利用这个帮助类来创建打开和管理数据库  新建一个项目，同时新建一个类MyOpenHelper继承SQLiteOpenHelper，实现两个方法和构造函数。 public class MyOpenHelper extends SQLite">
<meta name="keywords" content="Android">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Sqlite的使用">
<meta property="og:url" content="http://yoursite.com/2016/07/30/Sqlite/index.html">
<meta property="og:site_name" content="在树上的小白">
<meta property="og:description" content="1.MyOpenHelper帮助类Create a helper object to create, open, and/or manage a database.利用这个帮助类来创建打开和管理数据库  新建一个项目，同时新建一个类MyOpenHelper继承SQLiteOpenHelper，实现两个方法和构造函数。 public class MyOpenHelper extends SQLite">
<meta property="og:image" content="http://i.imgur.com/GxTjqBe.png">
<meta property="og:updated_time" content="2017-04-19T15:49:03.885Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Sqlite的使用">
<meta name="twitter:description" content="1.MyOpenHelper帮助类Create a helper object to create, open, and/or manage a database.利用这个帮助类来创建打开和管理数据库  新建一个项目，同时新建一个类MyOpenHelper继承SQLiteOpenHelper，实现两个方法和构造函数。 public class MyOpenHelper extends SQLite">
<meta name="twitter:image" content="http://i.imgur.com/GxTjqBe.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/07/30/Sqlite/"/>





  <title> Android Sqlite的使用 | 在树上的小白 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?13c43fe8e14f0229e4c41ce8755613a9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">在树上的小白</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">知其然，亦要知其所以然。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/30/Sqlite/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="杨小白">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="在树上的小白">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android Sqlite的使用
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-30T21:07:00+08:00">
                2016-07-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/07/30/Sqlite/" class="leancloud_visitors" data-flag-title="Android Sqlite的使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <h2 id="1-MyOpenHelper帮助类"><a href="#1-MyOpenHelper帮助类" class="headerlink" title="1.MyOpenHelper帮助类"></a>1.MyOpenHelper帮助类</h2><p><strong>Create a helper object to create, open, and/or manage a database</strong>.利用这个帮助类来创建打开和管理数据库</p>
<ul>
<li><p>新建一个项目，同时新建一个类MyOpenHelper继承SQLiteOpenHelper，实现两个方法和构造函数。</p>
<pre><code>public class MyOpenHelper extends SQLiteOpenHelper {
    public MyOpenHelper(Context context, String name, SQLiteDatabase.CursorFactory factory, int version) {
        super(context, name, factory, version);
    }

    @Override
    public void onCreate(SQLiteDatabase db) 
        //这个方法会在数据库被创建时调用
        //可以在里面实现创建表
        db.execSQL(&quot;create table clothes(_id integer primary key autoincrement,
                                        type char(20), price char(10),
                                        storage integer(15))&quot;);

    }

    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
        //这个方法会在数据库被更新的时候调用
        //可以在里面实现列的添加或者修改表名
    }
</code></pre><p>  }</p>
<ul>
<li><strong>db.execSQL(String sql)</strong>方法： 执行sql语句，不会返回数据。</li>
<li>文档中的解释：<br><strong>Execute a single SQL statement that is NOT a SELECT or any other SQL statement that returns data.</strong><ul>
<li><strong>sqlite创建表的语句</strong>：</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>create table table_name(
   column1 datatype  PRIMARY KEY(one or more columns),
   column2 datatype,
   column3 datatype,
   .....
   columnN datatype,
);
//create table 是告诉数据库系统创建一个新表的关键字。
//create table 语句后跟着表的唯一的名称或标识。
</code></pre><h2 id="2-在Android-Studio单元测试框架中进行数据库的增删改查"><a href="#2-在Android-Studio单元测试框架中进行数据库的增删改查" class="headerlink" title="2.在Android Studio单元测试框架中进行数据库的增删改查"></a>2.在Android Studio单元测试框架中进行数据库的增删改查</h2><p><img src="http://i.imgur.com/GxTjqBe.png" alt=""></p>
<p>我用的是AS2.1.1版本，在ApplicationTest中<br>创建方法<strong>public void test()</strong>,在test方法中编写测试代码，然后再右键test方法运行即可。</p>
<h3 id="两个测试框架中的方法"><a href="#两个测试框架中的方法" class="headerlink" title="两个测试框架中的方法"></a>两个测试框架中的方法</h3><pre><code>//测试框架初始化完毕之后，在测试方法执行之前，此方法调用
    @Override
    protected void setUp() throws Exception {
        super.setUp();
        oh = new MyOpenHelper(getContext(), &quot;shop.db&quot;, null, 2);
        db = oh.getWritableDatabase();//获取到数据库对象
    }
//测试框架测试方法运行完毕之后，此方法调用
@Override
    protected void tearDown() throws Exception {
        super.tearDown();
    }
</code></pre><ul>
<li><p>这里new出MyOpenHelper帮助类的时候传入的参数：</p>
<ul>
<li><strong>getContext()</strong>:获得一个虚拟的上下文。<ul>
<li>to use to open or create the database</li>
</ul>
</li>
<li><strong>“shop.db”</strong>：创建的数据库表名</li>
<li><strong>null(factory)：</strong>传null表示使用默认的。<ul>
<li>to use for creating cursor objects, or null for the default</li>
</ul>
</li>
<li><strong>2/版本号</strong>：至少为1。<ul>
<li>number of the database (starting at 1); </li>
</ul>
</li>
</ul>
</li>
<li><p><strong>getWritableDatabase()</strong>：用来创建或者打开数据库，如果数据库不存在就创建一个可读可写的数据库，存在就打开。</p>
<ul>
<li>Create and/or open a database that will be used for reading and writing.</li>
</ul>
</li>
<li>还有一个<strong>getReadableDatabase()</strong>方法，差别在于，如果存储空间满了，那么返回只读数据库对象，其他与getWritableDatabase()一样。</li>
</ul>
<h3 id="增删改查第一种方法之直接执行sqlite语句"><a href="#增删改查第一种方法之直接执行sqlite语句" class="headerlink" title="增删改查第一种方法之直接执行sqlite语句"></a>增删改查第一种方法之直接执行sqlite语句</h3><ul>
<li><p><strong>insert</strong>：</p>
<pre><code>public void insert(String type, String price, int storage){
    //?：占位符
        db.execSQL(&quot;insert into clothes (type, price, storage)values(?, ?, ?)&quot;,
            new Object[]{type, price, storage});//传入需要插入的值
    }
</code></pre></li>
</ul>
<ul>
<li><p><strong>delete</strong>:</p>
<pre><code>public void delete(String type){
    db.execSQL(&quot;delete from clothes where type = ?&quot;, new Object[]{type});
}
</code></pre></li>
<li><p><strong>update</strong>:</p>
<pre><code>public void update(){
        db.execSQL(&quot;update clothes set _id = ? where type = ?&quot;,
                 n ew Object[]{3 , &quot;内裤&quot;});
}
</code></pre></li>
<li><p><strong>select</strong>:</p>
<pre><code>public void select(){
    Cursor cursor = db.rawQuery(&quot;select type, price from clothes&quot;, null);
    while (cursor.moveToNext()){
        String type = cursor.getString(cursor.getColumnIndex(&quot;type&quot;));
        String price = cursor.getString(cursor.getColumnIndex(&quot;price&quot;));
        System.out.println(type+&quot;;&quot;+price);
    }
    }

//查询方法和之前的有点不一样，是用rawQuery()方法执行提供的sql语句，然后返回一个Cursor对象
 Runs the provided SQL and returns a Cursor over the result set
</code></pre><h3 id="增删改查第二张方法之调用API"><a href="#增删改查第二张方法之调用API" class="headerlink" title="增删改查第二张方法之调用API"></a>增删改查第二张方法之调用API</h3><p>调用API方法来进行增删改查，因为方法会返回一些数据，可以通过判断返回的数据是否等于想要得到的效果来编写相应的逻辑代码，可以防止因sql的语句出现错误导致的bug，不过实际上调用的API方法是系统封装好了的，底层还是在拼接sql语句并执行。</p>
</li>
<li><p><strong>insert</strong>：</p>
<pre><code>&gt; public long insert (String table, String nullColumnHack, ContentValues values)
</code></pre></li>
</ul>
<p><strong>return</strong>:the row ID of the newly inserted row, or -1 if an error occurred<br>这个方法会返回插入的行数，如果没有插入成功则返回-1</p>
<p><em>nullColumnHack</em>:只有在插入的values都为空的时候才用的上,基本上用不上</p>
<blockquote>
<p> 文档解释：If your provided values is empty, no column names are known and an empty row can’t be inserted. If not set to null, the nullColumnHack parameter provides the name of nullable column name to explicitly insert a NULL into in the case where your values is empty.</p>
</blockquote>
<pre><code>public void insertByAPI(){
    ContentValues values = new ContentValues();
    //ContentValues is used to store a set of values。存储键值对
    values.put(&quot;type&quot;,&quot;内裤&quot;);
    //put(key, value);前面这个key一定要是表列名，后面是要插入的值
    values.put(&quot;storage&quot;, &quot;20&quot;);
    values.put(&quot;price&quot;, 23);
    db.insert(&quot;clothes&quot;, null, values);
}
</code></pre><ul>
<li><p><strong>delete</strong>：</p>
<pre><code>public int deleteByAPI(){
    int i = db.delete(&quot;clothes&quot;,&quot;type = ? and _id = ?&quot;, 
                        new String[]{&quot;中裤&quot;,&quot;3&quot;});
    return i;
}
</code></pre></li>
<li><p><strong>update:</strong></p>
<pre><code>public void updateByAPI(){
    ContentValues values = new ContentValues();
    values.put(&quot;type&quot;, &quot;上衣&quot;);
    db.update(&quot;clothes&quot;, values, &quot;_id = ?&quot;, new String[]{&quot;2&quot;});
}
</code></pre></li>
<li><p><strong>select:</strong></p>
<pre><code>public void selectByAPI(){
    Cursor cursor = db.query(&quot;clothes&quot;,null,null, null,null,null,null,null);
    while (cursor.moveToNext()){
        String type = cursor.getString(cursor.getColumnIndex(&quot;type&quot;));
        String price = cursor.getString(cursor.getColumnIndex(&quot;price&quot;));
        System.out.println(type+&quot;;&quot;+price);
    }
}
</code></pre></li>
</ul>
<h2 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h2><p> sqlite是一个轻量级的数据库，内置于android应用中，会随着app的卸载而不存在。由于内存很小，所以也舍弃了一些功能，比如不会检查类型是否对应，插入数据时，integer类型可以插入char类型当中。</p>
<h4 id="总的来说，在android中使用sqlite，需要先建一个帮助类在完成数据库的创建和打开，管理。然后通过getWritableDatabase-获取数据库，然后对其进行增删改查操作。"><a href="#总的来说，在android中使用sqlite，需要先建一个帮助类在完成数据库的创建和打开，管理。然后通过getWritableDatabase-获取数据库，然后对其进行增删改查操作。" class="headerlink" title="总的来说，在android中使用sqlite，需要先建一个帮助类在完成数据库的创建和打开，管理。然后通过getWritableDatabase()获取数据库，然后对其进行增删改查操作。"></a>总的来说，在android中使用sqlite，需要先建一个帮助类在完成数据库的创建和打开，管理。然后通过getWritableDatabase()获取数据库，然后对其进行增删改查操作。</h4><hr>
<ul>
<li>sqlite相关知识来源于菜鸟教程：<a href="http://www.runoob.com/sql/sql-tutorial.html" title="菜鸟教程" target="_blank" rel="external">http://www.runoob.com/sql/sql-tutorial.html</a></li>
<li>文中的英文解释皆出自官方文档</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/03/android-Dalvik/" rel="next" title="android Dalvik">
                <i class="fa fa-chevron-left"></i> android Dalvik
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="杨小白" />
          <p class="site-author-name" itemprop="name">杨小白</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yangyouqian" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/yang-huan-shi-you-qian-xiao-bai/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-zhihu"></i>
                  
                  知乎
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://juejin.im/user/58e1f17261ff4b0061724b3b" target="_blank" title="掘金">
                  
                    <i class="fa fa-fw fa-juejin"></i>
                  
                  掘金
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-MyOpenHelper帮助类"><span class="nav-number">1.</span> <span class="nav-text">1.MyOpenHelper帮助类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-在Android-Studio单元测试框架中进行数据库的增删改查"><span class="nav-number">2.</span> <span class="nav-text">2.在Android Studio单元测试框架中进行数据库的增删改查</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#两个测试框架中的方法"><span class="nav-number">2.1.</span> <span class="nav-text">两个测试框架中的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增删改查第一种方法之直接执行sqlite语句"><span class="nav-number">2.2.</span> <span class="nav-text">增删改查第一种方法之直接执行sqlite语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增删改查第二张方法之调用API"><span class="nav-number">2.3.</span> <span class="nav-text">增删改查第二张方法之调用API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-总结"><span class="nav-number">3.</span> <span class="nav-text">3.总结</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#总的来说，在android中使用sqlite，需要先建一个帮助类在完成数据库的创建和打开，管理。然后通过getWritableDatabase-获取数据库，然后对其进行增删改查操作。"><span class="nav-number">3.0.1.</span> <span class="nav-text">总的来说，在android中使用sqlite，需要先建一个帮助类在完成数据库的创建和打开，管理。然后通过getWritableDatabase()获取数据库，然后对其进行增删改查操作。</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">杨小白</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("poKgMylvRgTsdXuKiEjm13qK-gzGzoHsz", "tvrufBj2EKsSezpYIbtVDMqA");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

</body>
</html>
